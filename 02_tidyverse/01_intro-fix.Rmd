---
title: "Stat 585 - elements of the tidyverse"
author: "Heike Hofmann"
output:
  xaringan::moon_reader:
    lib_dir: libs    
    css: [default, default-fonts, "tweaks.css"]
    nature:
      beforeInit: "macros.js"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

## tidyverse

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(dpi = 300)
library(tidyverse)
```


`tidyverse` is an 'opinionated' package bundling several other R packages for data science tasks:

```{r}
tidyverse::tidyverse_packages()
```
- https://cran.r-project.org/web/packages/tidyverse/vignettes/manifesto.html

- share common data representations and API, i.e. work well together

- see https://github.com/hadley/tidyverse for more information: [R for Data Science](https://r4ds.had.co.nz/)

- run  `tidyverse::tidyverse_update()` to check for updates

---

## Graphical and numerical summaries


1. graphical summaries - visualizations with `ggplot2`:

    - [RStudio cheatsheet for ggplot2](hhttps://raw.githubusercontent.com/rstudio/cheatsheets/main/data-visualization.pdf)
    
    - online documentation: https://ggplot2.tidyverse.org/
    
    - Google group: https://groups.google.com/forum/#!forum/ggplot2
  
2. numerical summaries - elements of `dplyr` and `tidyr`

  - assessing data quality; data wrangling

  - [RStudio cheatsheet for dplyr](https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-transformation.pdf)
  - [RStudio cheatsheet for tidyr](https://raw.githubusercontent.com/rstudio/cheatsheets/main/tidyr.pdf)
  
---

## The pipe operator `%>%`

`f(x) %>% g(y)` is equivalent to `g(f(x), y)`

i.e. the output of one function is used as input to the next function. This function can be the identity

Consequences:

- `x %>% f(y)` is the same as `f(x, y)`

- statements of the form `k(h(g(f(x, y), z), u), v, w)` become
`x %>% 
   f(y) %>% 
   g(z) %>% 
   h(u) %>% 
   k(v, w)`

- read `%>%` as "then do"


---

## dplyr 

There are five primary `dplyr` *verbs*, representing distinct data analysis tasks:

- **Filter**: Select specified rows of a data frame, produce subsets

- **Arrange**: Reorder the rows of a data frame

- **Select**: Select particular columns of a data frame

- **Mutate**: Add new or change existing columns of the data frame (as functions of existing columns)

- **Summarise**: Create collapsed summaries of a data frame

- (**Group By**: Introduce structure to a data frame)

<br>

`dplyr` resources:

- https://dplyr.tidyverse.org/

- R for Data Science book: https://r4ds.had.co.nz/transform.html

---
class: inverse
## Your Turn

The Iowa State Police Department publishes a Daily Crime Log at https://www.police.iastate.edu/crime-log/

Data for 2017 and most of 2018 are available as file [pd-isu.csv](https://raw.githubusercontent.com/Stat585-at-ISU/materials-2019/master/data/isu-pd.csv) from the course website.

Read the data into your R session and answer the following questions:

- which types of crimes (`Classification`) are typically committed? How many different classifications are there?

- which days are in the top ten for 2018? (Use the `lubridate` package to get to date variables)

- how many times a day are crimes typically reported? 

- what else do you find?

---
class: middle, center
## 

<img src = "https://imgs.xkcd.com/comics/tasks_2x.png" height = 300>

Don't peek unless you have tried for yourself!

---

# a solution 

```{r, message = FALSE, warning = FALSE}
library(tidyverse)
pd <- read_csv("../data/isu-pd.csv")

pd %>% count(Classification) %>% dim()
# 147 different types of crime classifications

pd  %>% count(Classification, sort = TRUE) %>% head()

```


---
